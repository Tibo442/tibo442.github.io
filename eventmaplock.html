<!doctype html>
<html>
    <head>
        <title>Flat is Justice! - lbas range map maker</title>
        <meta name="theme-color" content="#082E6B"/>
        <meta name=viewport content="width=device-width, initial-scale=1">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Flat is Justice - lbas range map maker">
        <meta name="twitter:description" content="Make LBAS range maps">
        <meta name="twitter:image" content="http://flatisjustice.moe/pics/lbasrangemapmaker.png">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.7.1/pixi.min.js"></script>
        <script src="https://unpkg.com/blob-util/dist/blob-util.min.js"></script>

        <style type="text/css">
            input[type="number"] {
                width:75px;
            }
            canvas {
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <a href="."><b>Flat is Justice - Home</b></a><br>
        <br>
        main.js section: <br><textarea id="code">
                    e.prototype._getBGTexture = function(t) {
                        switch (t) {
                            case 421:
                                return o.SALLY_STRATEGYMAP.getTexture(28);
                            case 422:
                                return o.SALLY_STRATEGYMAP.getTexture(29);
                            case 423:
                                return o.SALLY_STRATEGYMAP.getTexture(30);
                            case 424:
                                return r.SALLY_STRATEGYMAP_S.getTexture(23);
                            case 425:
                                return r.SALLY_STRATEGYMAP_S.getTexture(24);
                            default:
                                return PIXI.Texture.EMPTY
                        }
                    },
                    e.prototype._createAreaAnimation = function(t) {
                        this._cleanArea(),
                        421 == t ? this._createArea(128, 132, o.SALLY_STRATEGYMAP.getTexture(0)) : 422 == t ? (this._createArea(54, 37, o.SALLY_STRATEGYMAP.getTexture(1)), this._createArea(23, 98, o.SALLY_STRATEGYMAP.getTexture(2))) : 423 == t ? (this._createArea(0, 111, o.SALLY_STRATEGYMAP.getTexture(3)), this._createArea(40, 61, o.SALLY_STRATEGYMAP.getTexture(4))) : 424 == t ? (this._createArea(0, 1, r.SALLY_STRATEGYMAP_S.getTexture(0)), this._createArea(34, 45, r.SALLY_STRATEGYMAP_S.getTexture(1)), this._createArea(85, 63, r.SALLY_STRATEGYMAP_S.getTexture(2)), this._createArea(8, 135, r.SALLY_STRATEGYMAP_S.getTexture(3))) : 425 == t && (this._createArea(0, 0, r.SALLY_STRATEGYMAP_S.getTexture(4)), this._createArea(45, 94, r.SALLY_STRATEGYMAP_S.getTexture(5)), this._createArea(19, 144, r.SALLY_STRATEGYMAP_S.getTexture(6)), this._createArea(113, 146, r.SALLY_STRATEGYMAP_S.getTexture(7)))
                    },
                    e.prototype._createArrowAnimation = function(t) {
                        this._cleanArrow(),
                        421 == t ? (this._createArrow(18, 114, o.SALLY_STRATEGYMAP.getTexture(5), o.SALLY_STRATEGYMAP.getTexture(6)), this._createArrow(173, 15, o.SALLY_STRATEGYMAP.getTexture(7), o.SALLY_STRATEGYMAP.getTexture(8))) : 422 == t ? (this._createArrow(86, 151, o.SALLY_STRATEGYMAP.getTexture(9), o.SALLY_STRATEGYMAP.getTexture(10)), this._createArrow(103, 91, o.SALLY_STRATEGYMAP.getTexture(11), o.SALLY_STRATEGYMAP.getTexture(12))) : 423 == t ? (this._createArrow(68, 67, o.SALLY_STRATEGYMAP.getTexture(13), o.SALLY_STRATEGYMAP.getTexture(14)), this._createArrow(90, 36, o.SALLY_STRATEGYMAP.getTexture(15), o.SALLY_STRATEGYMAP.getTexture(16))) : 424 == t ? (this._createArrow(21, 41, r.SALLY_STRATEGYMAP_S.getTexture(8), r.SALLY_STRATEGYMAP_S.getTexture(9)), this._createArrow(83, 129, r.SALLY_STRATEGYMAP_S.getTexture(10), r.SALLY_STRATEGYMAP_S.getTexture(11))) : 425 == t && (this._createArrow(49, 36, r.SALLY_STRATEGYMAP_S.getTexture(12), r.SALLY_STRATEGYMAP_S.getTexture(13)), this._createArrow(38, 151, r.SALLY_STRATEGYMAP_S.getTexture(14), r.SALLY_STRATEGYMAP_S.getTexture(15)))
                    },
                    e.prototype._createLabelAnimation = function(t) {
                        this._cleanLabel(),
                        421 == t ? this._createLabel(4, 219, o.SALLY_STRATEGYMAP.getTexture(22), o.SALLY_STRATEGYMAP.getTexture(23)) : 422 == t ? this._createLabel(55, 196, o.SALLY_STRATEGYMAP.getTexture(24), o.SALLY_STRATEGYMAP.getTexture(25)) : 423 == t ? this._createLabel(41, 114, o.SALLY_STRATEGYMAP.getTexture(26), o.SALLY_STRATEGYMAP.getTexture(27)) : 424 == t ? this._createLabel(47, 108, r.SALLY_STRATEGYMAP_S.getTexture(19), r.SALLY_STRATEGYMAP_S.getTexture(20)) : 425 == t && this._createLabel(38, 105, r.SALLY_STRATEGYMAP_S.getTexture(21), r.SALLY_STRATEGYMAP_S.getTexture(22))
                    },
                    e.prototype._getTitleTexture = function(t) {
                        switch (t) {
                            case 421:
                                return o.SALLY_STRATEGYMAP.getTexture(31);
                            case 422:
                                return o.SALLY_STRATEGYMAP.getTexture(32);
                            case 423:
                                return o.SALLY_STRATEGYMAP.getTexture(33);
                            case 424:
                                return r.SALLY_STRATEGYMAP_S.getTexture(25);
                            case 425:
                                return r.SALLY_STRATEGYMAP_S.getTexture(26);
                            default:
                                return PIXI.Texture.EMPTY
                        }
                    },
                    e.prototype._createPlate = function(t) {
                        var e = this;
                        this._plate.removeChildren();
                        var i = function(t, i, n) {
                            var o = new PIXI.Sprite(t);
                            o.position.set(i, n),
                            e._plate.addChild(o)
                        };
                        421 == t ? i(o.SALLY_STRATEGYMAP.getTexture(19), 111, 95) : 422 == t ? i(o.SALLY_STRATEGYMAP.getTexture(20), 147, 132) : 423 == t ? i(o.SALLY_STRATEGYMAP.getTexture(21), 207, 47) : 424 == t ? i(r.SALLY_STRATEGYMAP_S.getTexture(16), 179, 166) : 425 == t && (i(r.SALLY_STRATEGYMAP_S.getTexture(17), 109, 196), i(r.SALLY_STRATEGYMAP_S.getTexture(18), 169, 32))
                    },

</textarea><br>
        Map: <input type="text" id="mapid" value="42" onchange="update()"> 
        <br>
        <button name="Update" onclick="update()">Force update</button><br><br>
        <a id="download">Download</a><br>
        <b>Edges map</b><br>
        <script type="text/javascript">
            var show = {}, locData, canvas, loader, map;
            let SERVER = "203.104.209.71";
 
            window.PIXI.utils.skipHello();
            let app = new PIXI.Application({width: 1500, height: 300, transparent: true, forceCanvas: true, preserveDrawingBuffer:true});
            document.body.appendChild(canvas = app.view);
            
            let xOff = 0, yOff = 0;

            let getTexture = (loc, id) => loc.toLowerCase() + '_' + id;
            let _createBG = (x,y,id) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff, y+yOff);
                bgLayer.addChild(sprite);
            };
            let _cleanArrow = () => 0;
            let _createArrow = (x,y,id) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff, y+yOff);
                arrowLayer.addChild(sprite);
            };
            let _cleanArea = () => 0;
            let _createArea = (x,y,id) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff, y+yOff);
                areaLayer.addChild(sprite);
            };
            let _createTitle = (x,y,id) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff+Math.round(140-sprite.width/2), y+yOff);
                titleLayer.addChild(sprite);
            };
            let _cleanLabel = () => 0;
            let _createLabel = (x,y,id) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff, y+yOff);
                titleLayer.addChild(sprite);
            };
            let i = (id, x,y) => {
                let frame = PIXI.Texture.fromFrame(id);
                let sprite = new PIXI.Sprite(frame);
                sprite.position.set(x+xOff, y+yOff);
                titleLayer.addChild(sprite);
            };
            let bgLayer, areaLayer, arrowLayer, titleLayer;

            function update(selectedmap = document.getElementById("mapid").value) {
                for (let i = app.stage.children.length - 1; i >= 0; i--) {  app.stage.removeChild(app.stage.children[i]); };
                app.stage.addChild(bgLayer = new PIXI.Container);
                app.stage.addChild(areaLayer = new PIXI.Container);
                app.stage.addChild(arrowLayer = new PIXI.Container);
                app.stage.addChild(titleLayer = new PIXI.Container);

                map = parseInt(selectedmap.replace('-'))
                let code = document.getElementById("code").value;

                let type = ''
                let currentCode = '\n';
                for(let line of code.split("\n")) {
                    if(line.indexOf('    },') > 0) {
                        console.log(`window.${type}=${currentCode}}`)
                        if(type != '')
                            eval(`window.${type}=${currentCode}}`)
                        type = '';
                        currentCode = '\n';
                    } else if(line.indexOf('prototype') > 0) {
                        console.log("pt", line);
                        for(let posType of ['_getBGTexture', '_getTitleTexture', '_createAreaAnimation', '_createArrowAnimation', '_createLabelAnimation', '_createPlate'])
                            if(line.indexOf(posType) > 0)
                                type = posType;

                        currentCode = line.split(' = ')[1]+'\n';
                    } else {
                        let rep = line.replace(/\w+.([\w]+)\.getTexture\(/g, "getTexture('$1', ").replace(/this./g, '')+'\n';

                        if(type == '_createPlate' && rep.indexOf(map) < 0)
                            continue;
                        currentCode += rep;
                    }
                }

                loader = new PIXI.loaders.Loader;

                loader.add(getPath('sally_strategymap.json')).add(getPath('sally_strategymap_s.json')).load(function() {
                    for(let i = 1; _getBGTexture(map*10+i) != PIXI.Texture.EMPTY; i++)
                        showMap(map*10+i);
                })
            }
            function getPath(url) {
                return `http://${SERVER}/kcs2/img/sally/${url}`
            }
            function showMap(map) {            
                console.log("Show map")
                console.log(map, _getBGTexture(map))
                xOff = (map%10-1)*300;
                _createBG(0,0,_getBGTexture(map));
                //_createArrowAnimation(map);
                _createAreaAnimation(map);
                //_createLabelAnimation(map);
                _createTitle(0,280,_getTitleTexture(map));
                //_createPlate(map);

                for(let dir of [[1,0,.5,0], [0,-1,1,.5]]) {
                    let text = new PIXI.Text("@FlatIsNice", secretstyle);
                    text.setTransform(app.stage.width*dir[2], app.stage.height*dir[3], 1, 1, Math.atan2(-dir[1], dir[0]));
                    text.anchor.set(.5,0);
                    text.alpha = 1/128;
                    app.stage.addChild(text);
                }

                app.render();
            }
            let secretstyle = new PIXI.TextStyle({
              fontFamily: "Arial",
              fontSize: 20,
              fill: "#080",
            });

            update();
        </script>
    </body>
</html>