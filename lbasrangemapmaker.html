<!doctype html>
<html>
    <head>
        <title>Flat is Justice! - lbas range map maker</title>
        <meta name="theme-color" content="#082E6B"/>
        <meta name=viewport content="width=device-width, initial-scale=1">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:title" content="Flat is Justice - lbas range map maker">
        <meta name="twitter:description" content="Make LBAS range maps">
        <meta name="twitter:image" content="http://flatisjustice.moe/pics/lbasrangemapmaker.png">
        <style type="text/css">
            input[type="number"] {
                width:75px;
            }
            canvas {
                margin: 5px;
            }
        </style>
    </head>
    <body>
        SWF XML: (example only has lineX part, feel free to put full file) <br><textarea id="swf">        <item characterId="3" clipDepth="0" depth="2" name="line0" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="13" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="2400" translateY="1840" type="MATRIX"/>
        </item>
        <item characterId="6" clipDepth="0" depth="4" name="line1" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="4420" translateY="2880" type="MATRIX"/>
        </item>
        <item characterId="9" clipDepth="0" depth="6" name="line2" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="5680" translateY="5660" type="MATRIX"/>
        </item>
        <item characterId="12" clipDepth="0" depth="8" name="line3" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="6260" translateY="3940" type="MATRIX"/>
        </item>
        <item characterId="15" clipDepth="0" depth="10" name="line4" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="7660" translateY="2860" type="MATRIX"/>
        </item>
        <item characterId="18" clipDepth="0" depth="12" name="line5" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="8100" translateY="4960" type="MATRIX"/>
        </item>
        <item characterId="21" clipDepth="0" depth="14" name="line6" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="8160" translateY="6120" type="MATRIX"/>
        </item>
        <item characterId="24" clipDepth="0" depth="16" name="line7" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="9800" translateY="3020" type="MATRIX"/>
        </item>
        <item characterId="27" clipDepth="0" depth="18" name="line8" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="10180" translateY="4800" type="MATRIX"/>
        </item>
        <item characterId="30" clipDepth="0" depth="20" name="line9" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="10520" translateY="6480" type="MATRIX"/>
        </item>
        <item characterId="33" clipDepth="0" depth="22" name="line10" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="11640" translateY="4700" type="MATRIX"/>
        </item>
        <item characterId="36" clipDepth="0" depth="24" name="line11" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="10680" translateY="1500" type="MATRIX"/>
        </item>
        <item characterId="39" clipDepth="0" depth="26" name="line12" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="13260" translateY="4880" type="MATRIX"/>
        </item>
        <item characterId="42" clipDepth="0" depth="28" name="line13" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="12640" translateY="2420" type="MATRIX"/>
        </item>
        <item characterId="45" clipDepth="0" depth="30" name="line14" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="6260" translateY="3940" type="MATRIX"/>
        </item>
        <item characterId="48" clipDepth="0" depth="32" name="line15" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="9800" translateY="3020" type="MATRIX"/>
        </item>
        <item characterId="51" clipDepth="0" depth="34" name="line16" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="10180" translateY="4800" type="MATRIX"/>
        </item>
        <item characterId="54" clipDepth="0" depth="36" name="line17" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="10520" translateY="6480" type="MATRIX"/>
        </item>
        <item characterId="57" clipDepth="0" depth="38" name="line18" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="15" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="12640" translateY="2420" type="MATRIX"/>
        </item>
        <item characterId="3" clipDepth="0" depth="40" name="line19" placeFlagHasCharacter="true" placeFlagHasClipActions="false" placeFlagHasClipDepth="false" placeFlagHasColorTransform="false" placeFlagHasMatrix="true" placeFlagHasName="true" placeFlagHasRatio="false" placeFlagMove="false" ratio="0" type="PlaceObject2Tag">
          <matrix hasRotate="false" hasScale="false" nRotateBits="0" nScaleBits="0" nTranslateBits="14" rotateSkew0="0" rotateSkew1="0" scaleX="0" scaleY="0" translateX="2960" translateY="5200" type="MATRIX"/>
        </item>
</textarea><br>
        start API (ingame): <br><textarea id="start">svdata={"api_result":1,"api_result_msg":"\u6210\u529f","api_data":{"api_cell_data":[{"api_id":434,"api_no":0,"api_color_no":4,"api_passed":0},{"api_id":435,"api_no":1,"api_color_no":4,"api_passed":1,"api_distance":1},{"api_id":436,"api_no":2,"api_color_no":4,"api_passed":0,"api_distance":1},{"api_id":437,"api_no":3,"api_color_no":4,"api_passed":1,"api_distance":2},{"api_id":438,"api_no":4,"api_color_no":4,"api_passed":1,"api_distance":3},{"api_id":439,"api_no":5,"api_color_no":4,"api_passed":0,"api_distance":3},{"api_id":440,"api_no":6,"api_color_no":4,"api_passed":0,"api_distance":2},{"api_id":441,"api_no":7,"api_color_no":10,"api_passed":1,"api_distance":4},{"api_id":442,"api_no":8,"api_color_no":10,"api_passed":0,"api_distance":4},{"api_id":443,"api_no":9,"api_color_no":4,"api_passed":0,"api_distance":3},{"api_id":444,"api_no":10,"api_color_no":4,"api_passed":0,"api_distance":4},{"api_id":445,"api_no":11,"api_color_no":4,"api_passed":0,"api_distance":5},{"api_id":446,"api_no":12,"api_color_no":4,"api_passed":0,"api_distance":5},{"api_id":447,"api_no":13,"api_color_no":5,"api_passed":1,"api_distance":5},{"api_id":448,"api_no":14,"api_color_no":4,"api_passed":1,"api_distance":2},{"api_id":449,"api_no":15,"api_color_no":10,"api_passed":1,"api_distance":4},{"api_id":450,"api_no":16,"api_color_no":10,"api_passed":0,"api_distance":4},{"api_id":451,"api_no":17,"api_color_no":4,"api_passed":0,"api_distance":3},{"api_id":452,"api_no":18,"api_color_no":5,"api_passed":1,"api_distance":5},{"api_id":456,"api_no":19,"api_color_no":0,"api_passed":0}],"api_rashin_flg":0,"api_rashin_id":0,"api_maparea_id":6,"api_mapinfo_no":5,"api_no":1,"api_color_no":4,"api_event_id":4,"api_event_kind":1,"api_next":1,"api_bosscell_no":18,"api_bosscomp":0,"api_airsearch":{"api_plane_type":0,"api_result":0},"api_from_no":0}}</textarea><br>
        Get from TsunDB: <input type="text" id="mapid" value = "40-4"> 
        <button name="tsunCollect" onclick="tsunDB(document.getElementById('mapid').value)">Get from TsunDB</button><br><br>
        Map bg URL: <input type="text" id="url" value = "https://i.imgur.com/ax5Tk5a.png"><br><br>
        <button name="Update" onclick="update()">Update</button><br><br>
        <b>LBAS Range</b><br>
        <canvas id="urlgraphrange" width="786" height="435" style="border:1px solid black;"></canvas><br>
        <b>Edges map (e = edges to this node, r = LBAS range)</b><br>
        <canvas id="swfgraphrange" width="786" height="435" style="border:1px solid black;"></canvas><br>
        <br><br>
        <b>How to extract information for this:</b><br>
        SWF XML: <br>
        1. Download <a href="https://www.free-decompiler.com/flash/" target="_blank">ffdec</a><br>
        2. Open map swf <i>/kcs/resources/swf/map/ww_mm.swf</i><br>
        3. Export SWF xml<br>
        4. Paste in full file (will load bg from file in edges map, keeps url in range map) OR only lineXX part (to keep url in both)<br>
        5.0 For events with hidden nodes: repeat process with <i>/kcs/scenes/SallyMain.swf</i> but instead of pasting full xml:<br>
        5.1 Look for lineXX scene part (control+f 'wwm_', where WW = 38/39/40/etc and m = 1/2/3/4/etc: example result: <i>&lt;item&gt;scene.sally.mc:MCCellSP401_13&lt;/item&gt;</i> this means the <b>above</b> items are from this map)<br>
        5.2 Control+f the routeXX/whiteXX/lineXX/labelXX/enemyXX for the part corresponding with said route unlock (there can be multiple route19's for example, look for correct map route19, compare with min/max of routes in both sections of file)<br>
        5.3 Paste ONLY this part (enclosed with subTags, only routeXX part is required) into SWF xml textbox<br>
        Example: <a href="http://kancolle.wikia.com/wiki/Fall_2017_Event/E-4">Fall 2017/E-4</a>: <a href="https://pastebin.com/ygFsJjuq">swf xml</a> (pastebin) + <a href="https://i.imgur.com/3DndZ6E.png">map bg url</a> = <a href="https://i.imgur.com/R8G3UzI.png">edges map output</a><br><br>
        start API (ingame): <br>
        Method 1: Manual gathering<br>
        1. Make sure you are saving/logging network requests and responses<br>
        2. Start to sortie to a map with LBAS<br>
        3. Open log, look for /start api call, copy FULL response into text box (including svdata=...)<br>
        Method 2: Getting from <a href="http://kckai.cybersnets.com/">TsunDB</a><br>
        1. Fill in map name in the format of ww-n (example: 40-4)<br>
        2. Click on <i>Get from TsunDB</i><br>
        <script type="text/javascript">
            var canvas = document.getElementById("urlgraphrange"), canvasswf = document.getElementById("swfgraphrange");
            var parser = new DOMParser();
            var swfData, split;
            function update() {
                eval((document.getElementById("start").value || "") == "" ? "svdata={}" : document.getElementById("start").value);
                swfData = document.getElementById("swf").value;
                split = swfData.split("\n");

                var context = canvas.getContext("2d");
                var img = new Image();
                img.onload = function() {
                    canvas.height = img.height;
                    canvas.width = img.width;
                    context.drawImage(img, 0, 0);
                    context.fillStyle = "rgba(128, 255, 0, 1)";
                    context.font = "30px Georgia";
                    context.textAlign = "center";

                    if(svdata && svdata.api_data && svdata.api_data.api_cell_data)
                        for(let a of svdata.api_data.api_cell_data) {
                            let x = getCoord(a.api_no)[0], y = getCoord(a.api_no)[1];
                            context.fillStyle = "rgba(128, 255, 0, .7)";
                            context.beginPath();
                            context.arc(x, y, 5, 0, 2 * Math.PI, false);
                            context.fill();
                            context.fillStyle = "rgba(128, 255, 0, 1)";
                            context.strokeStyle = 'rgba(32, 64, 0, .4)';
                            context.miterLimit = 2;
                            context.lineJoin = 'circle';
                            context.lineWidth = 7;
                            context.strokeText(a.api_distance || "/", x, y - 10);
                            context.lineWidth = 1;
                            context.fillText(a.api_distance || "/", x, y - 10);
                        }
                }
                img.src = document.getElementById("url").value;

                for(let i = 0; i < split.length; i++) 
                    if(split[i].includes("characterID=\"1\"")) {
                        drawEdges("data:image/jpeg;base64," + Convert(split[i].split("imageData=\"")[1].split("\"")[0]));
                        return;
                    }
                drawEdges(document.getElementById("url").value); 
            }
            function getCoord(id) {
                for(let i = 0; i < split.length; i++) {
                    if(split[i].includes("\"line" + id + "\"")) {
                        let x = split[i+1].split("translateX=\"")[1].split("\"")[0];
                        let y = split[i+1].split("translateY=\"")[1].split("\"")[0];
                        return [x/20,y/20];
                    }
                }                
            }

            function drawEdges(url) {
                var context2 = canvasswf.getContext("2d");
                var img2 = new Image();
                img2.onload = function() {
                    canvasswf.height = img2.height;
                    canvasswf.width = img2.width;
                    context2.drawImage(img2, 0, 0);
                    drawEdgesOnGraph(context2);
                }
                img2.src = url;
            }

            function drawEdgesOnGraph(context) {
                context.font = "15px Georgia";
                context.textAlign = "center";
                let highestEdge = 0;

                for(let j = 0; j < split.length; j++)
                    if(split[j].includes("name=\"line"))
                        highestEdge = Math.max(parseInt(split[j].split("line")[1].split("\"")[0], 10));

                let alledges = [];
                for(let id = 0; id <= highestEdge; id++) {
                    if(alledges.includes(id)) continue;
                    let edges = [];
                    let x = getCoord(id)[0], y = getCoord(id)[1];
                    for(let j = 0; j <= highestEdge; j++) {
                        let xj = getCoord(j)[0], yj = getCoord(j)[1];
                        if((x-xj)*(x-xj)+(y-yj)*(y-yj) < 500) {
                            edges.push(j);
                            alledges.push(j);
                        }
                    }
                    let node = ((((svdata||{}).api_data||{}).api_cell_data||[])[id]||{});
                    let dist = node.api_distance || "/";
                    let color = node.api_color_no || "/";

                    context.fillStyle = "rgba(128, 255, 0, .7)";
                    if(color == 4)
                        context.fillStyle = "rgba(255, 0, 0, .7)";
                    else if(color == 10)
                        context.fillStyle = "rgba(128, 64, 64, .7)";
                    else if(color == 11)
                        context.fillStyle = "rgba(128, 64, 100, .7)";
                    context.beginPath();
                    context.arc(x, y, 5, 0, 2 * Math.PI, false);
                    context.fill();
                    context.fillStyle = "rgba(128, 255, 0, 1)";
                    context.strokeStyle = 'rgba(32, 64, 0, .4)';
                    context.miterLimit = 2;
                    context.lineJoin = 'circle';
                    context.lineWidth = 7;
                    context.strokeText("e " + edges + "; c " + color + "; r " + dist, x, y - 15);
                    context.lineWidth = 1;
                    context.fillText("e " + edges + "; c " + color + "; r " + dist, x, y - 15);
                }
            }

            var base64_chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
            function binary_to_base64(input) {
                var ret = new Array();
                var i = 0;
                var j = 0;
                var char_array_3 = new Array(3);
                var char_array_4 = new Array(4);
                var in_len = input.length;
                var pos = 0;
            
                while (in_len--)
                {
                    char_array_3[i++] = input[pos++];
                    if (i == 3)
                    {
                        char_array_4[0] = (char_array_3[0] & 0xfc) >> 2;
                        char_array_4[1] = ((char_array_3[0] & 0x03) << 4) + ((char_array_3[1] & 0xf0) >> 4);
                        char_array_4[2] = ((char_array_3[1] & 0x0f) << 2) + ((char_array_3[2] & 0xc0) >> 6);
                        char_array_4[3] = char_array_3[2] & 0x3f;
            
                        for (i = 0; (i <4) ; i++)
                            ret += base64_chars.charAt(char_array_4[i]);
                        i = 0;
                    }
                }
            
                if (i)
                {
                    for (j = i; j < 3; j++)
                        char_array_3[j] = 0;
            
                    char_array_4[0] = (char_array_3[0] & 0xfc) >> 2;
                    char_array_4[1] = ((char_array_3[0] & 0x03) << 4) + ((char_array_3[1] & 0xf0) >> 4);
                    char_array_4[2] = ((char_array_3[1] & 0x0f) << 2) + ((char_array_3[2] & 0xc0) >> 6);
                    char_array_4[3] = char_array_3[2] & 0x3f;
            
                    for (j = 0; (j < i + 1); j++)
                        ret += base64_chars.charAt(char_array_4[j]);
            
                    while ((i++ < 3))
                        ret += '=';
          
              }
          
              return ret;
            }
        
            function Convert(inpimg) {
              if (inpimg.length % 2) 
                return;
              
              var binary = new Array();
              for (var i=0; i<inpimg.length/2; i++) {
                var h = inpimg.substr(i*2, 2);
                binary[i] = parseInt(h,16);        
              }
              return binary_to_base64(binary);
            } 

            function getJSON(url, callback) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.responseType = 'json';
                xhr.onload = function() {
                    var status = xhr.status;
                    if (status === 200) {
                        callback(xhr.response);
                    } else {
                        alert("Error with request " + url + ": " + status);
                    }
                };
                xhr.send();
            };
            function tsunDB(map) {
                getJSON(`http://kckai.cybersnets.com/api/routes/data/${map}?offset=0&limit=1&next_route=0`, function(data){
                    document.getElementById("start").value = "svdata = " + JSON.stringify({api_data: { api_cell_data: data[0].mapNodes } });
                });
            }
            update();
        </script>
    </body>
</html>